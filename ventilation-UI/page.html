<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="style/style.css">
</head>
<body>
    <div class="all">
        <h1>The control center!</h1>
        <div class="upper">
            <a class="logout" href="/logout">Logout</a> <br>
            <h4>Select the the options for the Mode</h4>
            <form class="form"action="javascript:submitform()">
                <tr>
                    <td><input id="manual" type="radio" name="mode" oninput="changeMode()" checked>Manual</td>
                    <td> <input id="auto" type="radio" name="mode" oninput="changeMode()">Auto</td>
                </tr>
                <h4 id="targetHeader">Target speed</h4>
                <input class="range" id="targetValue" type="range" min="0" max="100" oninput="document.getElementById('sliderOutput').value = this.value"><br>
                <input class="value" id="sliderOutput" type="number" value="50" oninput="document.getElementById('targetValue').value = this.value">
                <input class="button" type="submit">
            </form>
        </div>

        <div class="lower">
                <div class="speed">
                    <h4>Speed</h4>
                    <p id="Speed">0</p>
                </div>
                <div class="pressure">
                    <h4>Pressure</h4>
                    <p id="Pressure">0</p>
                </div>
                <div class ="co">
                    <h4>CO2</h4>
                    <p id="CO2">0</p>
                </div>
                <div class="rh">
                    <h4>RH</h4>
                    <p id="RH">0</p>
                </div>
                <div class ="temp">
                    <h4>Temp</h4>
                    <p id="Temp">0</p>
                </div>

        </div>


    </div>
</body>
</html>

<script>
    function submitform() {
        let auto = document.getElementById("auto");
        let mode = auto.checked ? "pressure" : "speed";
        let json = {
            "auto": auto.checked,
            [mode]: parseInt(document.getElementById("targetValue").value)
        }

        fetch('/send', {
            method: 'POST',
            body: JSON.stringify(json),
            headers: {
                "Content-Type": "application/json"
            }
        });
    }

    function changeMode() {
        let header = document.getElementById("targetHeader");
        let slider = document.getElementById("targetValue");
        let output = document.getElementById("sliderOutput");

        if (document.getElementById("auto").checked) {
            header.innerText = "Target pressure";
            slider.setAttribute("max", "120");
            slider.value = 60;
            output.value = 60;
        } else {
            header.innerText = "Target speed";
            slider.setAttribute("max", "100");
            slider.value = 50;
            output.value = 50;
        }
    }

    setInterval(function () {
        fetch('/update', {
            method: 'get'
        }).then(async function (res) {
            let dataJson = JSON.parse(await res.text());
            document.getElementById("Speed").innerText = dataJson["speed"];
            document.getElementById("Pressure").innerText = dataJson["pressure"] + " Pa";
            document.getElementById("CO2").innerText = dataJson["co2"] + " ppm";
            document.getElementById("RH").innerText = dataJson["rh"] + " %RH";
            document.getElementById("Temp").innerText = dataJson["temp"] + " Â°C";
        });
    }, 500);
</script>

